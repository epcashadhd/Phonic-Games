<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Phonics è½åŠ›ç‰¹è¨“: A èˆ‡ I</title>
    <style>
        /* --- æ‰‹æ©Ÿ/å¹³æ¿å„ªåŒ–æ¨£å¼ --- */
        * {
            box-sizing: border-box; /* ç¢ºä¿é‚Šæ¡†ä¸æœƒæ’å¤§å…ƒç´  */
            -webkit-tap-highlight-color: transparent; /* ç§»é™¤ iOS é»æ“Šæ™‚çš„ç°è‰²èƒŒæ™¯ */
        }

        body {
            font-family: "PingFang HK", "Microsoft JhengHei", "Varela Round", sans-serif;
            background-color: #E0F2F1;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            /* é˜²æ­¢æ‰‹æ©Ÿé›™æ“Šç¸®æ”¾ */
            touch-action: manipulation; 
        }

        .container {
            background-color: white;
            width: 100%;
            max-width: 600px;
            border-radius: 30px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
            border: 6px solid #80CBC4;
            position: relative;
        }

        /* é ‚éƒ¨è³‡è¨Šæ¬„ */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em; /* æ‰‹æ©Ÿä¸Šå­—é«”ç¨å¾®èª¿å° */
            color: #00796B;
            font-weight: bold;
            margin-bottom: 15px;
            background: #E0F2F1;
            padding: 10px;
            border-radius: 15px;
        }

        /* 1. ç™¼éŸ³æŒ‰éˆ• (å¤§å•è™Ÿ) - æ‰‹æ©Ÿç‰ˆé©æ‡‰ */
        .sound-btn {
            width: 110px;
            height: 110px;
            background: linear-gradient(135deg, #FF7043, #E64A19);
            border-radius: 50%;
            border: none;
            box-shadow: 0 6px 0 #BF360C;
            margin: 10px auto;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 0.1s;
        }

        .sound-btn:active {
            transform: scale(0.95);
            box-shadow: 0 3px 0 #BF360C;
        }

        .question-mark {
            font-size: 60px;
            color: white;
            font-weight: bold;
        }

        .playing { animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* 2. é¸é …å€åŸŸ - ä½¿ç”¨ Flexbox è‡ªå‹•æ›è¡Œ */
        .choices-area {
            display: flex;
            flex-wrap: wrap; 
            justify-content: center;
            gap: 15px; /* æŒ‰éˆ•é–“è· */
            margin-top: 20px;
            margin-bottom: 20px;
            min-height: 100px;
        }

        /* å­—æ¯å¡ç‰‡ - æ‰‹æ©Ÿç‰ˆå„ªåŒ– */
        .choice-card {
            background: white;
            border: 3px solid #4DB6AC;
            /* è®“æŒ‰éˆ•å¤§å°åœ¨æ‰‹æ©Ÿä¸Šæ›´éˆæ´» */
            width: 80px; 
            height: 80px;
            border-radius: 15px;
            font-size: 40px;
            color: #00796B;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 5px 0 #00695C;
            transition: all 0.1s;
            font-family: "Comic Sans MS", cursive;
            user-select: none; /* é˜²æ­¢é¸å–æ–‡å­— */
        }

        .choice-card:active { transform: translateY(5px); box-shadow: none; }

        /* å°éŒ¯æ¨£å¼ */
        .correct-bg {
            background-color: #C8E6C9 !important;
            border-color: #4CAF50 !important;
            color: #2E7D32 !important;
            box-shadow: 0 5px 0 #2E7D32 !important;
        }
        
        .wrong-shake {
            animation: shake 0.4s;
            background-color: #FFCDD2 !important;
            border-color: #F44336 !important;
        }
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
            100% { transform: translateX(0); }
        }

        /* ä¸‹ä¸€é¡ŒæŒ‰éˆ• - æ›´é©åˆæ‰‹æŒ‡é»æ“Š */
        .next-btn {
            background-color: #009688;
            color: white;
            border: none;
            padding: 15px 40px; /* åŠ å¤§é»æ“Šç¯„åœ */
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 0 #004D40;
            display: none;
            margin: 10px auto;
            width: 80%; /* æ‰‹æ©Ÿä¸ŠæŒ‰éˆ•å¯¬ä¸€é» */
            max-width: 300px;
            font-family: "PingFang HK", "Microsoft JhengHei", sans-serif;
        }
        .next-btn.show { display: block; animation: popIn 0.3s; }
        @keyframes popIn { 0% { transform: scale(0); } 100% { transform: scale(1); } }

        /* é–‹å§‹ç•«é¢é®ç½© */
        #start-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.98); z-index: 100;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center; border-radius: 30px;
            padding: 20px;
        }
        .big-start-btn {
            background: #FF5722; color: white; border: none;
            padding: 20px 60px; font-size: 1.5em; border-radius: 50px;
            cursor: pointer; box-shadow: 0 8px 0 #BF360C;
            font-family: "PingFang HK", "Microsoft JhengHei", sans-serif;
            width: 80%;
            max-width: 300px;
        }

        /* é‡å°è¶…å°è¢å¹•æ‰‹æ©Ÿ (å¦‚ iPhone SE) çš„å¾®èª¿ */
        @media (max-width: 380px) {
            .choice-card { width: 65px; height: 65px; font-size: 30px; }
            .sound-btn { width: 90px; height: 90px; }
            .question-mark { font-size: 45px; }
        }
    </style>
</head>
<body>

    <div class="container">
        
        <div id="start-overlay">
            <h1 style="color:#FF5722; margin-bottom: 10px;">Phonics è½åŠ›ç‰¹è¨“</h1>
            <p style="font-size:1.1em; color:#555; margin-bottom: 30px;">
                è«‹å°‡è²éŸ³æ‰“é–‹ ğŸ”Š<br>
                åˆ†è¾¨ <b>/a/</b> èˆ‡ <b>/i/</b>
            </p>
            <button class="big-start-btn" onclick="startGame()">é–‹å§‹éŠæˆ² â–¶ï¸</button>
        </div>

        <div class="top-bar">
            <span>ç¬¬ <span id="q-num">1</span> / 15 é¡Œ</span>
            <span>å¾—åˆ†: <span id="tick-count">0</span> âœ…</span>
        </div>

        <button class="sound-btn" id="speakerBtn" onclick="playSound()">
            <span class="question-mark">?</span>
        </button>
        <p style="color:#90A4AE; font-size:0.9em; margin-top: 5px;">é»æ“Šè½è²éŸ³</p>

        <div class="choices-area" id="choices-container"></div>

        <div id="feedback" style="height:30px; font-size:1.2em; font-weight:bold; color:#009688; margin-bottom:10px;"></div>

        <button class="next-btn" id="nextBtn" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ â¡ï¸</button>

        <audio id="player" playsinline></audio>
    </div>

    <script>
        // --- éŠæˆ²é‚è¼¯ ---
        let currentQuestionNum = 0;
        let ticks = 0;
        let currentTargetSound = ""; 
        let isRoundActive = true;
        
        // å­—æ¯åº«
        const allDistractors = "bcdefghjklmnopqrstuvwxyz".split(""); 

        function startGame() {
            // iOS Hack: å¿…é ˆåœ¨ä½¿ç”¨è€…ç¬¬ä¸€æ¬¡é»æ“Šæ™‚ï¼Œä¸»å‹•èˆ‡ audio äº’å‹•ä¸€æ¬¡
            // é€™æ¨£ç€è¦½å™¨æ‰æœƒå…è¨±ä¹‹å¾Œæ’­æ”¾è²éŸ³
            const player = document.getElementById('player');
            player.src = ""; 
            player.load(); 

            document.getElementById('start-overlay').style.display = 'none';
            nextQuestion();
        }

        function nextQuestion() {
            currentQuestionNum++;
            
            if (currentQuestionNum > 15) {
                finishGame();
                return;
            }

            // é‡ç½®ä»‹é¢
            isRoundActive = true;
            document.getElementById('q-num').innerText = currentQuestionNum;
            document.getElementById('feedback').innerText = "";
            document.getElementById('nextBtn').classList.remove('show');
            const container = document.getElementById('choices-container');
            container.innerHTML = ""; 

            // 1. æ±ºå®šé¡Œç›®ç›®æ¨™
            currentTargetSound = Math.random() < 0.5 ? 'a' : 'i';
            
            // é å…ˆè¼‰å…¥éŸ³é »
            const player = document.getElementById('player');
            player.src = currentTargetSound + ".mp3";
            player.load(); // ç¢ºä¿æ‰‹æ©Ÿç«¯æº–å‚™å¥½

            // 2. æ±ºå®šé¸é …
            let options = ['a', 'i'];

            // æ ¹æ“šé¡Œè™ŸåŠ å…¥å¹²æ“¾é …
            let numExtra = 0;
            if (currentQuestionNum >= 6 && currentQuestionNum <= 10) numExtra = 1;
            if (currentQuestionNum >= 11) numExtra = 3;

            if (numExtra > 0) {
                const shuffled = allDistractors.sort(() => 0.5 - Math.random());
                options = options.concat(shuffled.slice(0, numExtra));
            }

            options.sort(() => 0.5 - Math.random());

            // 3. ç”ŸæˆæŒ‰éˆ•
            options.forEach(letter => {
                const btn = document.createElement('div');
                btn.className = 'choice-card';
                btn.innerText = letter;
                btn.id = 'btn-' + letter;
                
                // æ”¯æ´è§¸æ§èˆ‡é»æ“Š
                btn.onclick = () => checkAnswer(letter);
                
                container.appendChild(btn);
            });
        }

        function playSound() {
            const btn = document.getElementById('speakerBtn');
            const player = document.getElementById('player');
            
            btn.classList.add('playing');
            
            // ç¢ºä¿æ¯æ¬¡é»æ“Šéƒ½é‡æ–°è¼‰å…¥æ’­æ”¾ï¼ˆè§£æ±ºéƒ¨åˆ† Android å•é¡Œï¼‰
            if (player.readyState === 0) player.load();

            player.play().then(() => {
                player.onended = () => btn.classList.remove('playing');
            }).catch((e) => {
                console.log(e);
                btn.classList.remove('playing');
                // å¦‚æœæ‰‹æ©Ÿç‰ˆå¤±æ•—ï¼Œé€šå¸¸æ˜¯å› ç‚ºæª”æ¡ˆè·¯å¾‘æˆ–ç€è¦½å™¨æ¬Šé™
                // alert("è«‹é»æ“Šé–‹å§‹æŒ‰éˆ•ä¾†å•Ÿå‹•éŸ³æ•ˆæ¬Šé™"); 
            });
        }

        function checkAnswer(choice) {
            if (!isRoundActive) return;

            const btn = document.getElementById('btn-' + choice);

            if (choice === currentTargetSound) {
                // ç­”å°
                isRoundActive = false;
                btn.classList.add('correct-bg');
                document.getElementById('feedback').innerText = "ç­”å°äº†ï¼ğŸ‰";
                
                ticks++;
                document.getElementById('tick-count').innerText = ticks;
                document.getElementById('nextBtn').classList.add('show');
            } else {
                // ç­”éŒ¯
                btn.classList.add('wrong-shake');
                document.getElementById('feedback').innerText = "å†è©¦ä¸€æ¬¡ï¼";
                
                setTimeout(() => {
                    btn.classList.remove('wrong-shake');
                }, 400);

                setTimeout(playSound, 300);
            }
        }

        function finishGame() {
            const container = document.querySelector('.container');
            container.innerHTML = `
                <h1 style="color:#FF7043">æŒ‘æˆ°å®Œæˆï¼</h1>
                <div style="font-size:5em; margin:20px;">ğŸ†</div>
                <p style="font-size:1.3em; color:#555;">ä½ çš„æˆç¸¾ï¼š <br> <span style="color:#009688; font-size:1.5em; font-weight:bold;">${ticks} / 15</span> åˆ†</p>
                <button class="next-btn show" onclick="location.reload()" style="position:static; margin-top:30px;">å†ç©ä¸€æ¬¡ ğŸ”„</button>
            `;
        }
    </script>
</body>
</html>